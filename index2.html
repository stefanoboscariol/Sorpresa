<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>TANTI AUGURI FLAâœ¨</title>

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #89f7fe, #66a6ff);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      overflow: hidden;
      color: #333;
    }

    .card {
      background: #f0f8ff;
      padding: 2.2rem 1.8rem;
      border-radius: 24px;
      max-width: 420px;
      width: 92%;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,.2);
      animation: pop .5s ease;
    }

    @keyframes pop {
      from { transform: scale(.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    h1 { color: #2575fc; margin-bottom: 1rem; }
    p { line-height: 1.5; margin-bottom: 1rem; }

    button {
      background: linear-gradient(135deg,#6a11cb,#2575fc);
      border: none;
      color: #fff;
      padding: .7rem 1.4rem;
      font-size: 1rem;
      border-radius: 999px;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(0,0,0,.25);
    }

    .hidden { display: none; }

    /* === ESERCIZIO 1 PUNTINI === */
    .dots {
      position: relative;
      height: 180px;
      margin: 1rem 0;
    }

    canvas {
      position: absolute;
      inset: 0;
    }

    .dot {
      width: 22px;
      height: 22px;
      background: #2575fc;
      border-radius: 50%;
      position: absolute;
      cursor: pointer;
      transform: translate(-50%, -50%);
    }

    /* === TAP GRID === */
    #tapGrid {
      position: relative;
      width: 100%;
      height: 200px;
      border: 2px dashed #2575fc;
      border-radius: 16px;
      overflow: hidden;
      margin: 1rem 0;
    }

    /* === FINALE === */
    .fall {
      position: fixed;
      top: -10vh;
      font-size: 26px;
      animation: fallDown linear forwards;
      opacity: .85;
      pointer-events: none;
    }

    @keyframes fallDown {
      from { transform: translateY(-120vh); }
      to { transform: translateY(120vh); }
    }
  </style>
</head>

<body>

<!-- LIVELLO 1 -->
<div class="card" id="lvl1">
  <h1>ğŸ‘‹ Ciao Flavietta!</h1>
  <p>Una piccola sorpresaâ€¦<br>ma va conquistata ğŸ˜‰</p>
  <button onclick="goTo('lvl1','lvl2')">Iniziamo ğŸ®</button>
</div>

<!-- LIVELLO 2 -->
<div class="card hidden" id="lvl2">
  <h1>ğŸ§© Livello 1</h1>
  <p>Unisci i puntini in ordine</p>
  <div class="dots">
    <canvas id="lineCanvas" width="360" height="180"></canvas>
    <div class="dot" style="top:130px; left:50px" onclick="hitDot(1)"></div>
    <div class="dot" style="top:40px; left:180px" onclick="hitDot(2)"></div>
    <div class="dot" style="top:130px; left:310px" onclick="hitDot(3)"></div>
  </div>
</div>

<!-- LIVELLO 3 -->
<div class="card hidden" id="lvl3">
  <h1>â• Livello 2</h1>
  <p>Quanto fa <b>7 Ã— 6</b>?</p>
  <button onclick="wrong()">36</button>
  <button onclick="right()">42</button>
  <button onclick="wrong()">48</button>
  <p id="mathMsg"></p>
</div>

<!-- LIVELLO 4 -->
<div class="card hidden" id="lvl4">
  <h1>âš¡ Livello 3</h1>
  <p>Tocca i fulmini!</p>
  <p><small>Hai 1 minuto â±ï¸</small></p>
  <div id="tapGrid"></div>
  <p id="tapScore"></p>
</div>

<!-- LIVELLO 5 -->
<div class="card hidden" id="lvl5">
  <h1>ğŸ˜ Livello 4</h1>
  <p>Carino dai ğŸ˜</p>
  <button onclick="goTo('lvl5','lvl6')">Continua ğŸ‰</button>
</div>

<!-- FINALE -->
<div class="card hidden" id="lvl6">
  <h1>ğŸ‰ AUGURI FLAVIA ğŸ‰</h1>
  <p>
    Un nuovo capitolo sta iniziando ğŸ“–<br>
    Forse non perfettoâ€¦<br>
    ma decisamente memorabile ğŸ«¶ğŸ»ğŸ’™
  </p>
  <button onclick="finale()">âœ¨ Guarda âœ¨</button>
</div>

<script>
function goTo(a,b){
  document.getElementById(a).classList.add('hidden');
  document.getElementById(b).classList.remove('hidden');
}

/* === PUNTINI === */
let step=1, last=null;
const ctx=document.getElementById('lineCanvas').getContext('2d');

function hitDot(n){
  if(n!==step) return;
  const d=event.target;
  const r=d.getBoundingClientRect();
  const p=d.parentElement.getBoundingClientRect();
  const x=r.left-p.left+11, y=r.top-p.top+11;
  if(last){
    ctx.beginPath();
    ctx.moveTo(last.x,last.y);
    ctx.lineTo(x,y);
    ctx.strokeStyle='#2575fc';
    ctx.lineWidth=4;
    ctx.stroke();
  }
  last={x,y};
  step++;
  if(step===4) setTimeout(()=>goTo('lvl2','lvl3'),600);
}

/* === MATH === */
function wrong(){ document.getElementById('mathMsg').textContent='Riprova ğŸ˜œ'; }
function right(){
  document.getElementById('mathMsg').textContent='Grande ğŸ˜';
  setTimeout(()=>goTo('lvl3','lvl4'),700);
}

/* === FULMINI === */
function startBolts(){
  const g=document.getElementById('tapGrid');
  const s=document.getElementById('tapScore');
  g.innerHTML=''; let hit=0;

  for(let i=0;i<8;i++){
    const b=document.createElement('div');
    b.textContent='âš¡';
    b.style.position='absolute';
    b.style.top=Math.random()*160+'px';
    b.style.left=Math.random()*320+'px';
    b.style.fontSize='2rem';
    b.onclick=()=>{hit++; b.remove(); s.textContent='âš¡ '+hit;};
    g.appendChild(b);
  }

  setTimeout(()=>goTo('lvl4','lvl5'),60000);
}

new MutationObserver(m=>{
  if(!document.getElementById('lvl4').classList.contains('hidden')) startBolts();
}).observe(lvl4,{attributes:true});

/* === FINALE === */
function finale(){
  const items=['âš¡','ğŸ«¶ğŸ»','ğŸ’™'];
  for(let i=0;i<18;i++){
    const e=document.createElement('div');
    e.className='fall';
    e.textContent=items[Math.floor(Math.random()*items.length)];
    e.style.left=Math.random()*100+'vw';
    e.style.animationDuration=(4+Math.random()*3)+'s';
    document.body.appendChild(e);
    setTimeout(()=>e.remove(),7000);
  }
}
</script>

</body>
</html>
