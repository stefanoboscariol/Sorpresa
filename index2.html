<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TANTI AUGURI FLAâœ¨</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #89f7fe, #66a6ff);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      color: #333;
      overflow: hidden;
    }

    .card {
      background: #f0f8ff;
      padding: 2.5rem 2rem;
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      max-width: 420px;
      width: 90%;
      text-align: center;
      animation: pop 0.6s ease-out;
    }

    @keyframes pop {
      from { transform: scale(0.85); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    h1 { font-size: 1.9rem; margin-bottom: 1rem; color: #2575fc; }
    p  { font-size: 1.05rem; line-height: 1.5; margin-bottom: 1rem; }

    button {
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      border: none;
      color: white;
      font-size: 1rem;
      padding: 0.7rem 1.4rem;
      border-radius: 999px;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(38,79,255,0.4);
      margin-top: 0.5rem;
    }

    .hidden { display: none; }
    .choices button { margin: 0.35rem; }

    .dots {
      position: relative;
      width: 100%;
      aspect-ratio: 2 / 1;
      margin: 1rem 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .dot {
      width: 22px;
      height: 22px;
      background: #2575fc;
      border-radius: 50%;
      position: absolute;
      cursor: pointer;
      z-index: 2;
      top: var(--top);
      left: var(--left);
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
      width: 100%;
      height: 100%;
    }

    #tapGrid {
      position: relative;
      width: 100%;
      height: 200px;
      border: 2px dashed #2575fc;
      border-radius: 16px;
      margin: 1rem 0;
    }

    .lightning { position: absolute; font-size: 2rem; animation: fall 2s linear infinite; }
    @keyframes fall {
      from { transform: translateY(-50px); }
      to { transform: translateY(250px); }
    }

    .heart, .emoji {
      position: absolute;
      font-size: 26px;
      animation: floatUp 6s linear infinite;
      opacity: 0.7;
    }

    @keyframes floatUp {
      from { transform: translateY(0); opacity: 0.7; }
      to { transform: translateY(-110vh); opacity: 0; }
    }
  </style>
</head>

<body>

<!-- LIVELLO 1 -->
<div class="card" id="lvl1">
  <h1>ğŸ‘‹ Ciao Flavietta!</h1>
  <p>Questa Ã¨ una piccola sorpresaâ€¦<br>ma per arrivare in fondo dovrai <b>guadagnartela</b> ğŸ˜‰</p>
  <button onclick="goTo('lvl1','lvl2')">Iniziamo ğŸ®</button>
</div>

<!-- LIVELLO 2 -->
<div class="card hidden" id="lvl2">
  <h1>ğŸ§© Livello 1</h1>
  <p>Unisci i puntini in ordine</p>
  <div class="dots">
    <canvas id="lineCanvas"></canvas>
    <div class="dot" style="--top: 67%; --left: 11%;" onclick="hitDot(1,this)"></div>
    <div class="dot" style="--top: 22%; --left: 47%;" onclick="hitDot(2,this)"></div>
    <div class="dot" style="--top: 67%; --left: 83%;" onclick="hitDot(3,this)"></div>
  </div>
</div>

<!-- LIVELLO 3 -->
<div class="card hidden" id="lvl3">
  <h1>â• Livello 2</h1>
  <p><b>Quanto fa 7 Ã— 6?</b></p>
  <div class="choices">
    <button onclick="mathWrong()">36</button>
    <button onclick="mathRight()">42</button>
    <button onclick="mathWrong()">48</button>
  </div>
  <p id="mathMsg"></p>
</div>

<!-- LIVELLO 4 -->
<div class="card hidden" id="lvl4">
  <h1>âš¡ Livello 3</h1>
  <p>Tocca piÃ¹ fulmini possibile âš¡</p>
  <p><small>Hai <b>1 minuto</b> â±ï¸</small></p>
  <div id="tapGrid"></div>
  <p id="tapScore"></p>
</div>

<!-- LIVELLO 5 -->
<div class="card hidden" id="lvl5">
  <h1>ğŸ˜ Livello 4</h1>
  <p>Carino eh?</p>
  <div class="choices">
    <button onclick="choiceWrong()">Nhaa ğŸ¤”</button>
    <button onclick="choiceRight()">Carino dai ğŸ‰</button>
  </div>
</div>

<!-- LIVELLO FINALE -->
<div class="card hidden" id="lvl6">
  <h1>ğŸ‰ AUGURI FLA ğŸ‰</h1>
  <p>
    Un altro capitolo sta per iniziare ğŸ†<br>
    Non potrÃ  esser bello come lo scorso,<br>
    in cui ho fatto capolino io (hihihi),<br>
    ma proveremo a renderlo memorabile ğŸ’™ğŸ«¶ğŸ»
  </p>
  <button onclick="spawnFinalElements()">âœ¨ Guarda âœ¨</button>
</div>

<script>
  function goTo(from,to){
    document.getElementById(from).classList.add('hidden');
    document.getElementById(to).classList.remove('hidden');
  }

  /* Puntini con linee */
  let currentDot = 1;
  let lastPos = null;
  const canvas = document.getElementById('lineCanvas');
  const ctx = canvas.getContext('2d');

  function resizeCanvas() {
    const dotsContainer = canvas.parentElement;
    canvas.width = dotsContainer.offsetWidth;
    canvas.height = dotsContainer.offsetHeight;
  }

  function hitDot(n, el){
    if(n !== currentDot) return;
    
    resizeCanvas();
    
    const rect = el.getBoundingClientRect();
    const canvasRect = canvas.getBoundingClientRect();
    
    const x = (rect.left - canvasRect.left) + 11;
    const y = (rect.top - canvasRect.top) + 11;

    if(lastPos){
      ctx.beginPath();
      ctx.moveTo(lastPos.x, lastPos.y);
      ctx.lineTo(x, y);
      ctx.strokeStyle = '#2575fc';
      ctx.lineWidth = 4;
      ctx.lineCap = 'round';
      ctx.stroke();
    }
    lastPos = {x,y};
    currentDot++;
    if(currentDot === 4){
      setTimeout(()=>goTo('lvl2','lvl3'),600);
    }
  }

  // Posiziona i puntini responsivamente
  window.addEventListener('load', resizeCanvas);
  window.addEventListener('resize', resizeCanvas);

  /* Matematica */
  function mathWrong(){
    document.getElementById('mathMsg').textContent = 'Riprova ğŸ˜';
  }
  function mathRight(){
    document.getElementById('mathMsg').textContent = 'Perfetto ğŸ˜';
    setTimeout(()=>goTo('lvl3','lvl4'),900);
  }

  /* Fulmini â€“ 1 minuto */
  function startTapGame(){
    const grid = document.getElementById('tapGrid');
    const score = document.getElementById('tapScore');
    grid.innerHTML='';
    let hits = 0;

    const interval = setInterval(()=>{
      const bolt = document.createElement('div');
      bolt.textContent='âš¡';
      bolt.style.position='absolute';
      bolt.style.left=Math.random()*90+'%';
      bolt.style.top=Math.random()*80+'%';
      bolt.style.fontSize='2rem';
      bolt.onclick=()=>{
        hits++;
        bolt.remove();
        score.textContent = `Fulmini: ${hits}`;
      };
      grid.appendChild(bolt);
      setTimeout(()=>bolt.remove(),2500);
    },700);

    setTimeout(()=>{
      clearInterval(interval);
      score.textContent = `Tempo scaduto! Fulmini: ${hits}`;
      setTimeout(()=>goTo('lvl4','lvl5'),1500);
    },60000); // 1 minuto
  }

  new MutationObserver(()=>{
    if(!document.getElementById('lvl4').classList.contains('hidden')){
      startTapGame();
    }
  }).observe(document.getElementById('lvl4'),{attributes:true});

  function choiceWrong(){ alert('Daiiii ğŸ˜'); }
  function choiceRight(){ goTo('lvl5','lvl6'); }

  /* Finale â€“ pochi cuori */
  function spawnFinalElements(){
    for(let i=0;i<6;i++){
      const heart=document.createElement('div');
      heart.className='heart';
      heart.textContent='ğŸ’™';
      heart.style.left=Math.random()*100+'vw';
      document.body.appendChild(heart);
      setTimeout(()=>heart.remove(),6000);
    }

    for(let i=0;i<10;i++){
      const emoji=document.createElement('div');
      emoji.className='emoji';
      emoji.textContent='ğŸ«¶ğŸ»';
      emoji.style.left=Math.random()*100+'vw';
      document.body.appendChild(emoji);
      setTimeout(()=>emoji.remove(),6000);
    }
  }
</script>

</body>
</html>